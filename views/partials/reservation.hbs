<!DOCTYPE html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Reservation Form Page</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

	<style>
		.seat {
			width: 50px;
			height: 40px;
			line-height: 40px;
			text-align: center;
			border: 1px solid #ccc;
			border-radius: 5px;
			cursor: pointer;
			user-select: none;
		}
		.seat:hover {
			background-color: #e9ecef;
		}
		.seat.selected {
			background-color: #198754;
			color: white;
			border-color: #198754;
		}
		.spacing {
			width: 40px;
			display: inline-block;
		}
		#summaryPanel {
			display: none;	/* this keeps #summaryPanel hidden on initial page load; shown later via jQuery script */
		}
	</style>
</head>

<body>
	<nav class="navbar navbar-dark bg-dark">
		<div class="container-fluid">
			<a class="navbar-brand" href="#">CCS Airlines (Main Menu)</a>'
			<div class="ms-auto">
				<a class="btn btn-outline-light" href="/flights/search">Search Flights</a>
				<a class="btn btn-outline-light" href="/reservation/form">Book Flights</a>
				<a class="btn btn-outline-light" href="/reservation/list">My Reservations</a>
				<a class="btn btn-outline-light" href="/">Profile</a>
			</div>
		</div>
	</nav>
	<div class="container mt-4">
		<h1 class="text-center mb-4">Reservation Form</h1>

		<!-- Alert Message -->
		<div id="alertContainer"></div>

		<div class="card p-3 mb-3">
			<!-- A.) Passenger Details -->
			<h5>Passenger Details</h5>

			<form id="reservationForm">
				<div class="mb-3">
					<label class="form-label">Name:</label>
					<input type="text" id="name" class="form-control" required>
				</div>

				<div class="mb-3">
					<label class="form-label">Email:</label>
					<input type="email" id="email" class="form-control" required>
				</div>

				<div class="mb-3">
					<label class="form-label">Passport Number:</label>
					<input type="text" id="passport" class="form-control" required>
				</div>

				<!-- B.) Package Details -->
				<h5 class="mt-4">Package Details</h5>

				<div class="mb-3">
					<label class="form-label">Meal Options:</label>
					<select class="form-select" id="meal" required>
						<option value="0">None</option>
						<option value="50">Standard - $50</option>
						<option value="60">Vegetarian - $60</option>
						<option value="70">Kosher - $70</option>
					</select>
				</div>

				<div class="mb-3">
					<label class="form-label">Seat Selection:</label>
					<div id="seatMap" class="container text-center mb-3"></div>
					<input type="text" id="selectedSeat" class="form-control" placeholder="Selected seat" readonly required>
				</div>

				<div class="mb-3">
					<label class="form-label">Total Baggages:</label>
					<input type="number" id="baggages" class="form-control" value="1" min="0" required>
				</div>

				<button type="button" id="submitReservation" class="btn btn-primary">Submit Reservation</button>
			</form>
		</div>

		<!-- Summary Panel -->
		<div id="summaryPanel" class="card border-success mb-4">
			<div class="card-header bg-success text-white">
				<h5 class="mb-0">Summary Panel</h5>
			</div>
			<div class="card-body">
				<p id="summaryText"></p>
				<h5>Total Amount: <span id="totalAmount" class="text-success"></span></h5>
			</div>
		</div>
	</div>

	<!-- Bootstrap Bundle (with JS for modal) -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<!-- jQuery Script -->
	<script>
	$(document).ready(function() {
		// Generate seat grid (5 rows, from A to F, with space between C and D to resemble an airplane seating arrangement)
		const seatMap = $("#seatMap");
		const seatLetters = ['A', 'B', 'C', 'D', 'E', 'F'];
		for (let row = 1; row <= 5; row++) {
			const rowDiv = $('<div class="d-flex justify-content-center mb-2"></div>');
			seatLetters.forEach((letter) => {
				if (letter === 'D') {
					rowDiv.append('<div class="spacing"></div>');
				}
				const seat = $(`<div class="seat mx-1" data-seat="${row}${letter}">${row}${letter}</div>`);
				rowDiv.append(seat);
			});
			seatMap.append(rowDiv);
		}

		// Seat selection
		$(document).on("click", ".seat", function() {
			$(".seat").removeClass("selected");
			$(this).addClass("selected");
			$("#selectedSeat").val($(this).data("seat"));
			updateSummary();
		});

		// Show alert (used for validation)
		function showAlert(message, type = "danger") {
			$("#alertContainer").html(`
				<div class="alert alert-${type} alert-dismissible fade show" role="alert">
					${message}
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
			`);
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}

		// Validation (checks if any required field inside #reservationForm is empty)
		function formIsFilled() {
			let valid = true;
			$("#reservationForm [required]").each(function() {
				if ($.trim($(this).val()) === "") {
					valid = false;
					return false;
				}
			});
			return valid;
		}

		// Update summary panel content and total price
		function updateSummary() {
			if (!formIsFilled()) {
				$("#summaryPanel").hide();
				return;
			}

			// Get data
			let name = $("#name").val();
			let email = $("#email").val();
			let passport = $("#passport").val();
			let meal = $("#meal option:selected").text();
			let mealPrice = parseInt($("#meal").val()) || 0;
			let seat = $("#selectedSeat").val();
			let baggages = parseInt($("#baggages").val());
			let total = mealPrice + (baggages * 30);

			let summary = `
				<b>Passenger:</b> ${name}<br>
				<b>Email:</b> ${email}<br>
				<b>Passport No.:</b> ${passport}<br>
				<b>Meal Option:</b> ${meal}<br>
				<b>Seat:</b> ${seat}<br>
				<b>Baggages:</b> ${baggages} × $30
			`;

			$("#summaryText").html(summary);
			$("#totalAmount").text(`$${total}`);
			$("#summaryPanel").fadeIn();
		}

		// Update the summary panel live when any input/select changes found in input fields of #reservationForm with 'required' attribute
		$("#reservationForm input, #reservationForm select").on("change keyup", function() {
			updateSummary();
		});

		// Submit button (shows warning if #reservationForm with 'required' attribute has missing fields)
		$("#submitReservation").click(function() {
			if (!formIsFilled()) {
				showAlert("⚠️ Please fill out all required fields before submitting!", "warning");
				return;
			}
			updateSummary();
		});
	});
	</script>
</body>

</html>
